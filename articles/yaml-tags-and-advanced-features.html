<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>YAML Tags, Anchors, and Advanced Features with yaml12 • yaml12</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="YAML Tags, Anchors, and Advanced Features with yaml12">
<script src="https://cdn.jsdelivr.net/gh/posit-dev/supported-by-posit/js/badge.min.js" data-max-height="43" data-light-bg="#666f76" data-light-fg="#f9f9f9"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">yaml12</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/yaml-2-minute-intro.html">YAML in 2 Minutes: A Gentle Introduction for R Users</a></li>
    <li><a class="dropdown-item" href="../articles/yaml-tags-and-advanced-features.html">YAML Tags, Anchors, and Advanced Features with yaml12</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/r-yaml12/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>YAML Tags, Anchors, and Advanced Features with yaml12</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/posit-dev/r-yaml12/blob/main/vignettes/yaml-tags-and-advanced-features.Rmd" class="external-link"><code>vignettes/yaml-tags-and-advanced-features.Rmd</code></a></small>
      <div class="d-none name"><code>yaml-tags-and-advanced-features.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://posit-dev.github.io/r-yaml12/">yaml12</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette picks up where the “YAML in 2 Minutes” intro leaves
off. It shows what YAML tags are and how to work with them in yaml12
with tag handlers. Along the way we also cover complex-valued keys and
node anchors, so you can work with any advanced YAML (version 1.2) you
might see in the wild.</p>
<div class="section level2">
<h2 id="tags-in-yaml-and-how-yaml12-handles-them">Tags in YAML and how yaml12 handles them<a class="anchor" aria-label="anchor" href="#tags-in-yaml-and-how-yaml12-handles-them"></a>
</h2>
<p>Tags annotate any YAML node with extra meaning. In YAML syntax a tag
always starts with <code>!</code>, and it appears before the node’s
value; it is not part of the scalar text itself.</p>
<p><em>yaml12</em> attaches tags as a <code>yaml_tag</code> attribute
(always a string). The most common form is a simple local short tag that
starts with <code>!</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">"!some_tag some_value"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; structure("some_value", yaml_tag = "!some_tag")</span></span></code></pre></div>
<p>The presence of a custom tag bypasses normal scalar node type
inference; the scalar is always returned as a string even when the
content looks like another type.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">"! true"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "true"</span></span>
<span><span class="co">#&gt; attr(,"yaml_tag")</span></span>
<span><span class="co">#&gt; [1] "!"</span></span>
<span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">"true"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-handlers-to-transform-tagged-nodes-while-parsing">Using handlers to transform tagged nodes while parsing<a class="anchor" aria-label="anchor" href="#using-handlers-to-transform-tagged-nodes-while-parsing"></a>
</h2>
<p><code><a href="../reference/parse_yaml.html">parse_yaml()</a></code> and <code><a href="../reference/parse_yaml.html">read_yaml()</a></code> accept
<code>handlers</code>: a named list of functions whose names are YAML
tag strings. Handlers run on any matching tagged node. For tagged
scalars, the handler always receives a length-1 string; for tagged
sequences or mappings, it receives an R vector representing that
node.</p>
<p>Here is an example of using a handler to evaluate <code>!expr</code>
nodes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">handlers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"!expr"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">str2lang</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">globalenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">"!expr 1+1"</span>, handlers <span class="op">=</span> <span class="va">handlers</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>Any errors from a handler stop parsing:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">"!expr stop('boom')"</span>, handlers <span class="op">=</span> <span class="va">handlers</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(str2lang(x), globalenv()): boom</span></span></code></pre></div>
<p>Any tag without a matching handler is left preserved as
<code>yaml_tag</code> attribute, and handlers without matching tags are
left unused.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">handlers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"!expr"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">str2lang</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">globalenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="st">"!upper"</span> <span class="op">=</span> <span class="va">toupper</span>,</span>
<span>  <span class="st">"!lower"</span> <span class="op">=</span> <span class="va">tolower</span> <span class="co"># unused</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span>handlers <span class="op">=</span> <span class="va">handlers</span>, <span class="st">"</span></span>
<span><span class="st">- !expr 1+1</span></span>
<span><span class="st">- !upper r is awesome</span></span>
<span><span class="st">- !note this tag has no handler</span></span>
<span><span class="st">"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : num 2</span></span>
<span><span class="co">#&gt;  $ : chr "R IS AWESOME"</span></span>
<span><span class="co">#&gt;  $ : chr "this tag has no handler"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "yaml_tag")= chr "!note"</span></span></code></pre></div>
<p>With a tagged sequence, the handler is called with an unnamed R list,
or an atomic vector if <code>simplify = TRUE</code> and all the sequence
elements are a common type. With tagged mappings the handler is called
with a named R list, potentially with a <code>yaml_keys</code> attribute
(more on this in the next section).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">handlers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"!some_seq_tag"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="st">"some handled value"</span></span>
<span>  <span class="op">}</span>,</span>
<span>  <span class="st">"!some_map_tag"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>key1 <span class="op">=</span> <span class="fl">1L</span>, key2 <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="st">"some other handled value"</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">yaml_tagged_containers</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">- !some_seq_tag [a, b]</span></span>
<span><span class="st">- !some_map_tag {key1: 1, key2: 2}</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="va">yaml_tagged_containers</span>, handlers <span class="op">=</span> <span class="va">handlers</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ : chr "some handled value"</span></span>
<span><span class="co">#&gt;  $ : chr "some other handled value"</span></span></code></pre></div>
<p>Handlers make it easy to opt into powerful behaviors (like evaluating
<code>!expr</code> nodes) while keeping the default parser strict and
safe.</p>
<div class="section level3">
<h3 id="post-process-tags-yourself">Post-process tags yourself<a class="anchor" aria-label="anchor" href="#post-process-tags-yourself"></a>
</h3>
<p>If you want more control, you can parse first without
<code>handlers</code> and then walk the result yourself. For example,
you can process <code>!expr</code>-tagged scalars yourself by walking
the yaml nodes simply like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eval_yaml_expr_nodes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">eval_yaml_expr_nodes</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"yaml_tag"</span>, <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"!expr"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">str2lang</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">globalenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">safe_loaded</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">"!expr 1 + 1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="va">safe_loaded</span><span class="op">)</span></span>
<span><span class="co">#&gt; structure("1 + 1", yaml_tag = "!expr")</span></span>
<span><span class="fu">eval_yaml_expr_nodes</span><span class="op">(</span><span class="va">safe_loaded</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="mappings-revisited-non-string-keys-and-yaml_keys">Mappings revisited: non-string keys and <code>yaml_keys</code><a class="anchor" aria-label="anchor" href="#mappings-revisited-non-string-keys-and-yaml_keys"></a>
</h2>
<p>In YAML, mapping keys do not have to be plain scalar strings; any
arbitrary YAML node can be a key: including other scalar types,
sequences, and even other mappings. For example, this is valid YAML even
though the key is a boolean:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">true</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div>
<p>When <em>yaml12</em> sees a mapping key that is not a untagged string
scalar, it keeps the original keys in a <code>yaml_keys</code> attribute
next to the values:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">"true: true"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; structure(list(TRUE), names = "", yaml_keys = list(TRUE))</span></span></code></pre></div>
<p>For complex key values, YAML uses the explicit mapping-key indicator
<code>?</code>. A line starting with ? introduces the key node (of any
type) of a mapping, and the following line that starts with
<code>:</code> holds its value:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">?</span><span class="at"> </span><span class="kw">[</span><span class="at">a</span><span class="kw">,</span><span class="at"> b</span><span class="kw">]</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="kw">:</span><span class="at"> value with a sequence key</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="kw">?</span><span class="at"> </span><span class="kw">{</span><span class="fu">x</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span><span class="kw">,</span><span class="at"> </span><span class="fu">y</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span><span class="kw">}</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="kw">:</span><span class="at"> value with a mapping key</span></span></code></pre></div>
<p>In yaml12 you can see those keys via the <code>yaml_keys</code>
attribute:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yaml</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">true: true</span></span>
<span><span class="st">? [a, b]</span></span>
<span><span class="st">: tuple</span></span>
<span><span class="st">? {x: 1, y: 2}</span></span>
<span><span class="st">: map-key</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="va">yaml</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : logi TRUE</span></span>
<span><span class="co">#&gt;  $ : chr "tuple"</span></span>
<span><span class="co">#&gt;  $ : chr "map-key"</span></span>
<span><span class="co">#&gt;  - attr(*, "yaml_keys")=List of 3</span></span>
<span><span class="co">#&gt;   ..$ : logi TRUE</span></span>
<span><span class="co">#&gt;   ..$ : chr [1:2] "a" "b"</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ x: int 1</span></span>
<span><span class="co">#&gt;   .. ..$ y: int 2</span></span></code></pre></div>
<div class="section level3">
<h3 id="tagged-mapping-keys">Tagged mapping keys<a class="anchor" aria-label="anchor" href="#tagged-mapping-keys"></a>
</h3>
<p>If you supply handlers, they run on keys as well, so a handler can
turn tagged keys into friendly R names before <code>yaml_keys</code>
needs to be attached. If all the mapping keys resolve to bare scalar
strings, then a <code>yaml_keys</code> attribute is not attached.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">handlers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"!upper"</span> <span class="op">=</span> <span class="va">toupper</span>,</span>
<span>  <span class="st">"!airport"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"IATA:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">yaml_tagged_key</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">!upper newyork: !airport jfk</span></span>
<span><span class="st">!upper warsaw: !airport waw</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="va">yaml_tagged_key</span>, handlers <span class="op">=</span> <span class="va">handlers</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ NEWYORK: chr "IATA:JFK"</span></span>
<span><span class="co">#&gt;  $ WARSAW : chr "IATA:WAW"</span></span></code></pre></div>
<p>If you anticipate tagged mapping keys that you want to process
yourself, you’ll need a bit more bookkeeping. The <code>yaml_keys</code>
attribute is materialized whenever any key is not a plain, untagged
string scalar; you’ll want to walk those keys alongside the values and
optionally collapse <code>yaml_keys</code> back to <code>NULL</code> if
all keys become plain strings after handling tagged nodes. For example,
here is the earlier <code>eval_yaml_expr_nodes</code> expanded to also
handle tagged mapping keys. (This expanded postprocessor is equivalent
to passing
<code>handlers = list("!expr" = \(x) eval(str2lang(x), globalenv()))</code>)</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_bare_string</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1L</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">key</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">eval_yaml_expr_nodes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">eval_yaml_expr_nodes</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"yaml_keys"</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">keys</span>, <span class="va">eval_yaml_expr_nodes</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>        \<span class="op">(</span><span class="va">name</span>, <span class="va">key</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">""</span> <span class="op">&amp;&amp;</span> <span class="fu">is_bare_string</span><span class="op">(</span><span class="va">key</span><span class="op">)</span><span class="op">)</span> <span class="va">key</span> <span class="kw">else</span> <span class="va">name</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>        <span class="va">keys</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"yaml_keys"</span><span class="op">)</span> <span class="op">&lt;-</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">keys</span>, <span class="va">is_bare_string</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="cn">NULL</span> <span class="kw">else</span> <span class="va">keys</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"yaml_tag"</span>, <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"!expr"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">str2lang</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">globalenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Because you control the traversal, you can add extra checks (for
example, only allowing expressions under certain mapping keys).</p>
</div>
</div>
<div class="section level2">
<h2 id="document-streams-and-markers">Document Streams and Markers<a class="anchor" aria-label="anchor" href="#document-streams-and-markers"></a>
</h2>
<p>Most YAML files contain a single YAML <em>document</em>. YAML also
supports <em>document streams</em>, where a file or string holds
multiple YAML documents. Documents are separated by a start marker
(<code>---</code>) and may optionally include an end marker
(<code>...</code>).</p>
<div class="section level3">
<h3 id="reading-multiple-documents">Reading Multiple Documents<a class="anchor" aria-label="anchor" href="#reading-multiple-documents"></a>
</h3>
<p>For the reading functions (<code><a href="../reference/parse_yaml.html">read_yaml()</a></code>,
<code><a href="../reference/parse_yaml.html">parse_yaml()</a></code>), the <code>multi</code> argument defaults to
<code>FALSE</code>. In this mode, only the first YAML document is read.
If an end marker (<code>...</code>) or a new start marker
(<code>---</code>) is encountered, the parser stops and returns only the
first document. When <code>multi = TRUE</code>, all documents in the
stream are returned.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doc_stream</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">---</span></span>
<span><span class="st">doc 1</span></span>
<span><span class="st">---</span></span>
<span><span class="st">doc 2</span></span>
<span><span class="st">"</span></span>
<span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="va">doc_stream</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "doc 1"</span></span>
<span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="va">doc_stream</span>, multi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "doc 1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "doc 2"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="writing-multiple-documents">Writing Multiple Documents<a class="anchor" aria-label="anchor" href="#writing-multiple-documents"></a>
</h3>
<p>For the writing functions (<code><a href="../reference/format_yaml.html">write_yaml()</a></code>,
<code><a href="../reference/format_yaml.html">format_yaml()</a></code>), <code>multi</code> also defaults to
<code>FALSE</code>, producing a single YAML document. When
<code>multi = TRUE</code>, the provided R object is treated as a list of
documents and written as a YAML document stream, with documents
separated by the start marker <code>---</code>. Regardless of
<code>multi</code>, <code><a href="../reference/format_yaml.html">write_yaml()</a></code> always includes an initial
start marker and a final end marker.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/format_yaml.html">write_yaml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"foo"</span>, <span class="st">"bar"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; - foo</span></span>
<span><span class="co">#&gt; - bar</span></span>
<span><span class="co">#&gt; ...</span></span>
<span><span class="fu"><a href="../reference/format_yaml.html">write_yaml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"foo"</span>, <span class="st">"bar"</span><span class="op">)</span>, multi <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; foo</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; bar</span></span>
<span><span class="co">#&gt; ...</span></span></code></pre></div>
<p>When <code>multi = FALSE</code>, parsing stops after the first
document—even if later content is not valid YAML. That makes it easy to
extract front matter from files that mix YAML with other text (like R
Markdown):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rmd_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"---"</span>,</span>
<span>  <span class="st">"title: Front matter only"</span>,</span>
<span>  <span class="st">"params:"</span>,</span>
<span>  <span class="st">"  answer: 42"</span>,</span>
<span>  <span class="st">"---"</span>,</span>
<span>  <span class="st">"# Body that is not YAML"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="va">rmd_lines</span><span class="op">)</span></span>
<span><span class="co">#&gt; $title</span></span>
<span><span class="co">#&gt; [1] "Front matter only"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $params</span></span>
<span><span class="co">#&gt; $params$answer</span></span>
<span><span class="co">#&gt; [1] 42</span></span></code></pre></div>
<p>Here the parser returns just the YAML frontmatter because the second
<code>---</code> technically ends the first <em>YAML document</em> in a
<em>YAML document stream</em>; with <code>multi = FALSE</code> the
parser stops there and returns just the first YAML document.</p>
</div>
</div>
<div class="section level2">
<h2 id="writing-yaml-with-tags">Writing YAML with tags<a class="anchor" aria-label="anchor" href="#writing-yaml-with-tags"></a>
</h2>
<p>To emit a tag, attach <code>yaml_tag</code> to an R value before
calling <code><a href="../reference/format_yaml.html">format_yaml()</a></code> or <code><a href="../reference/format_yaml.html">write_yaml()</a></code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tagged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="st">"1 + x"</span>, yaml_tag <span class="op">=</span> <span class="st">"!expr"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/format_yaml.html">write_yaml</a></span><span class="op">(</span><span class="va">tagged</span><span class="op">)</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; !expr 1 + x</span></span>
<span><span class="co">#&gt; ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="anchors">Anchors<a class="anchor" aria-label="anchor" href="#anchors"></a>
</h2>
<p>Anchors (<code>&amp;id</code>) name a node; aliases
(<code>*id</code>) copy it. yaml12 resolves aliases before returning R
objects.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">recycle-me: &amp;anchor-name</span></span>
<span><span class="st">  a: b</span></span>
<span><span class="st">  c: d</span></span>
<span><span class="st"></span></span>
<span><span class="st">recycled:</span></span>
<span><span class="st">  - *anchor-name</span></span>
<span><span class="st">  - *anchor-name</span></span>
<span><span class="st">"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 2</span></span>
<span><span class="co">#&gt;  $ recycle-me:List of 2</span></span>
<span><span class="co">#&gt;   ..$ a: chr "b"</span></span>
<span><span class="co">#&gt;   ..$ c: chr "d"</span></span>
<span><span class="co">#&gt;  $ recycled  :List of 2</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ a: chr "b"</span></span>
<span><span class="co">#&gt;   .. ..$ c: chr "d"</span></span>
<span><span class="co">#&gt;   ..$ :List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ a: chr "b"</span></span>
<span><span class="co">#&gt;   .. ..$ c: chr "d"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="very-advanced-tags">(Very) Advanced Tags<a class="anchor" aria-label="anchor" href="#very-advanced-tags"></a>
</h2>
<p>The following are some YAML features that are rarely used, but are
supported for 100% compliance with the YAML 1.2 spec.</p>
<div class="section level3">
<h3 id="tag-directives-tag">Tag directives (<code>%TAG</code>)<a class="anchor" aria-label="anchor" href="#tag-directives-tag"></a>
</h3>
<p>YAML lets you declare tag handles at the top of a document with
<code>%TAG</code> directives. The syntax is
<code>%TAG !&lt;name&gt;! &lt;handle&gt;</code>, and it applies to the
rest of the document. The <code>!name!</code> is then automatically
expanded in named tags:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="pp">%TAG !e! tag:example.com,2024:widgets/</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="fu">item</span><span class="kw">:</span><span class="at"> !e!gizmo</span></span></code></pre></div>
<p>Here the tag prefix <code>!e!</code> is automatically expanded to the
full form upon parsing.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">%TAG !e! tag:example.com,2024:widgets/</span></span>
<span><span class="st">---</span></span>
<span><span class="st">item: !e!gizmo foo</span></span>
<span><span class="st">'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; list(item = structure("foo", yaml_tag = "tag:example.com,2024:widgets/gizmo"))</span></span></code></pre></div>
<p>You can also declare a global tag prefix, which will expand a bare
“!”</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">%TAG ! tag:example.com,2024:widgets/</span></span>
<span><span class="st">---</span></span>
<span><span class="st">item: !gizmo foo</span></span>
<span><span class="st">'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; list(item = structure("foo", yaml_tag = "tag:example.com,2024:widgets/gizmo"))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tag-uris">TAG URIs<a class="anchor" aria-label="anchor" href="#tag-uris"></a>
</h3>
<p>The above two forms are actually shorthands for resolving a tag
“URI”. You can bypass handle resolution by using the following tag
syntax: <code>!&lt;...&gt;</code> Anything in <code>...</code> will not
be expanded, but must be a valid URI (e.g., spaces must be escaped, like
in a URL).</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="st">'</span></span>
<span><span class="st">%TAG ! tag:example.com,2024:widgets/</span></span>
<span><span class="st">---</span></span>
<span><span class="st">item: !&lt;gizmo&gt; foo</span></span>
<span><span class="st">'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; list(item = structure("foo", yaml_tag = "gizmo"))</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="core-schema-tags">Core schema tags<a class="anchor" aria-label="anchor" href="#core-schema-tags"></a>
</h3>
<p>You may also encounter tags that start with two <code>!!</code>. This
is a special case of the <code>!name!suffix</code> tag syntax, where
<code>name</code> is missing and undefined and implicitly resolved to
the YAML Core schema handle: <code>tag:yaml.org,2002:</code>.</p>
<p>The following three tags all resolve to the same internal
representation and parse the same way:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="st">'</span></span>
<span><span class="st">- foo</span></span>
<span><span class="st">- !!str foo</span></span>
<span><span class="st">- !&lt;tag:yaml.org,2002:str&gt; foo</span></span>
<span><span class="st">'</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/dput.html" class="external-link">dput</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; c("foo", "foo", "foo")</span></span></code></pre></div>
<p>Core schema tags are generally unnecessary since all nodes are
resolved using the core schema already. However, they can be an
alternative way to declare node types. The valid set of core schema
tags: <code>map</code>, <code>seq</code>, <code>str</code>,
<code>int</code>, <code>float</code>, <code>bool</code>,
<code>null</code>.</p>
<p>Note that YAML 1.2 <a href="https://yaml.org/spec/1.2.2/ext/changes/" class="external-link">removed</a> some
built-in types that were present in YAML 1.1.</p>
<blockquote>
<p>The !!pairs, !!omap, !!set, !!timestamp and !!binary types have been
dropped.</p>
</blockquote>
<p>Correspondingly, in <em>yaml12</em> these formerly core tags come
into R as any other unhandled tagged scalar, as strings with a
<code>yaml_tag</code> attribute. Note that the <code>pairs</code>,
<code>omap</code>, and <code>set</code> are generally not meaningful in
R, since all the R objects returned are ordered (and <em>yaml12</em>
automatically preserves the order of mapping entries).</p>
<p>The <a href="https://yaml.org/type/timestamp.html" class="external-link"><code>!!timestamp</code></a>
and <a href="https://yaml.org/type/binary.html" class="external-link"><code>!!binary</code></a> tags
are occasionally useful, but the logic for handing richer types is
encouraged to live at the application level, and not in the core
schema.</p>
<p>Note that with <code>!!</code>, the parser expands the first global
prefix to <code>tag:yaml.org,2002:</code> (unless a tag directive
changed the meaning of <code>!!</code>), and the tags come in with a
fully resolved core schema URI.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yaml</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">- !!timestamp 2025-01-01</span></span>
<span><span class="st">- !!timestamp 2025-01-01 21:59:43.10 -5</span></span>
<span><span class="st">- !!binary UiBpcyBBd2Vzb21l</span></span>
<span><span class="st">"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="va">yaml</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : chr "2025-01-01"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "yaml_tag")= chr "tag:yaml.org,2002:timestamp"</span></span>
<span><span class="co">#&gt;  $ : chr "2025-01-01 21:59:43.10 -5"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "yaml_tag")= chr "tag:yaml.org,2002:timestamp"</span></span>
<span><span class="co">#&gt;  $ : chr "UiBpcyBBd2Vzb21l"</span></span>
<span><span class="co">#&gt;   ..- attr(*, "yaml_tag")= chr "tag:yaml.org,2002:binary"</span></span></code></pre></div>
<p>You can supply a handler for them if you want to convert them from a
character string to some other R object:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Timestamp handler: Convert date-only into Date, otherwise try (some of) the</span></span>
<span><span class="co"># YAML 1.1 spec valid timestamp formats as POSIX formats.</span></span>
<span><span class="co"># return NA on failure.</span></span>
<span><span class="va">timestamp_handler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^\\d{4}-\\d{2}-\\d{2}$"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">formats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"%Y-%m-%dT%H:%M:%OS%z"</span>,</span>
<span>    <span class="st">"%Y-%m-%d %H:%M:%OS%z"</span>,</span>
<span>    <span class="st">"%Y-%m-%dT%H:%M:%OS"</span>,</span>
<span>    <span class="st">"%Y-%m-%d %H:%M:%OS"</span>,</span>
<span>    <span class="st">"%Y-%m-%d %H:%M"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">x</span>, tryFormats <span class="op">=</span> <span class="va">formats</span>, optional <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Binary handler: decode Base64 into raw</span></span>
<span><span class="va">binary_handler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/base64.html" class="external-link">base64_dec</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[ \n]"</span>, <span class="st">""</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu"><a href="../reference/parse_yaml.html">parse_yaml</a></span><span class="op">(</span><span class="va">yaml</span>, handlers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"tag:yaml.org,2002:timestamp"</span> <span class="op">=</span> <span class="va">timestamp_handler</span>,</span>
<span>  <span class="st">"tag:yaml.org,2002:binary"</span> <span class="op">=</span> <span class="va">binary_handler</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 3</span></span>
<span><span class="co">#&gt;  $ : Date[1:1], format: "2025-01-01"</span></span>
<span><span class="co">#&gt;  $ : POSIXct[1:1], format: "2025-01-01 21:59:43"</span></span>
<span><span class="co">#&gt;  $ : raw [1:12] 52 20 69 73 ...</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Tomasz Kalinowski, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

  </div></footer>
</body>
</html>
